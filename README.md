# 接合部性能評価プログラム

**接合部及びその倍率の試験・評価業務方法書**に準拠した性能評価Webアプリケーションです。

## 概要

本プログラムは、建築基準法施行令第46条第4項表1の(八)の認定申請に係る性能評価プロセスを実装しています。実験データ（正負交番載荷試験）から、以下の法的性能指標を算出します。

### 主要な評価項目
- 基礎性能値: Pmax（最大耐力）、Py（降伏耐力）、Pu（終局耐力）、μ（塑性率）
- 法的性能: P0（短期基準せん断耐力）、Pa（短期許容せん断耐力）

### 準拠する技術基準（要点）
- 包絡線: 最初の立ち上がりからピークまで上昇区間を結び、Pmax以降は計測点を結ぶ（破壊時の急低下点は除外）
- 降伏耐力Pyの算定: 作図法（第I直線[0.1-0.4Pmax]、第II直線[0.4-0.9Pmax]、第III直線[接線]の交点）
- 降伏変位δyの算定: 包絡線と第IV直線（Py水平線）の交点
- 終局耐力Puの算定: 等価エネルギー吸収法（完全弾塑性モデル）、δuが包絡線点間でも線形補間により正確に計算
- 短期基準せん断耐力P0: 2つの基準 (a)降伏耐力、(b)最大耐力基準 の最小値

## 使い方

### 1. ファイルの準備
`index.html` をブラウザで開きます。

### 2. データ入力（この版はテキスト直接入力方式）
- 変形 δ (mm): 1行1データ
- 荷重 P (kN): 1行1データ
- ヘッダー行や空白行、単位付き文字列（例: "0.001 mm"、"3.2kN"）は自動的に無視されます。
- クリップボードから貼り付け: 「δペースト」「Pペースト」「両方ペースト」ボタンで一括入力可能
  - タブ区切りまたはカンマ区切りの2列データは自動判定し、δとPの両欄に分割して入力

### 3. 解析実行
3点以上の有効データ入力で自動実行。以下が表示されます:
- **グラフ**: 包絡線、評価直線（Line I～VI）、特性点（Pmax, Py, Pu, δy, δv, δu）、P0基準ライン（a～b）
- **結果テーブル**: 全性能値

### 4. 包絡線の編集（高度な操作）
- **点の選択**: 包絡線点をクリックして選択（赤く強調表示）
- **点の移動**: Ctrl+Shift+ドラッグで選択点を移動（実験データ折れ線への吸着機能付き）
 - **点の移動**: 次の2通り 1) 新ボタン「マウスドラッグ移動ON」を押してそのままドラッグ（パン/ズーム抑止） 2) 従来通り Ctrl+Shift+ドラッグ。いずれも実験データ折れ線への吸着機能付き。
- **点の削除**: 選択後にDeleteキーで削除（Box/Lassoで複数選択可）
- **点の追加**: 選択点の隣に中点を挿入（ダイアログ内「追加」ボタン）
- **数値編集**: 選択点をクリックして右側に表示されるダイアログで δ, P を直接入力
- **Undo/Redo**: 左上ボタンまたは Ctrl+Z / Ctrl+Y
- 編集後は自動で再計算され、結果が即座に更新されます

### 5. 表示操作
- **パン/ズーム**: マウスドラッグ（パン）、ホイール（ズーム）
- **包絡線にフィット**: モードバー右上「包絡線にフィット」ボタンで包絡線全体を表示
- **凡例**: 各トレースの表示/非表示切替(クリックで個別トグル、ダブルクリックで単独表示)
- **注釈表示**: グラフ下の選択ボックスで注釈の表示/非表示を切替
  - すべて表示: 全ての注釈を表示
  - 主要のみ: Pmax, Py, Pu, δy, δv, δu を表示
  - P0基準のみ: P0(a)～(b)の基準ラインのみ表示
  - 非表示: すべての注釈を非表示

### 6. 結果のダウンロード
- **Excel出力**: 結果サマリ、入力データ、包絡線、グラフ画像を含む `.xlsx` ファイル
- **PDFレポート**: 入力パラメータ、計算結果、グラフを含む評価レポート（jsPDF使用）

## ファイル構成（本リネーム後）
```
./
├── index.html        # メインHTML
├── app.js            # 評価ロジック実装
├── styles.css        # スタイル
├── sample.csv        # サンプルデータ（起動時自動読込）
└── README.md         # 本ドキュメント
```

## 主な機能

### 自動解析
- 3点以上のデータ入力で即座に解析実行（手動ボタン不要）
- パラメータ変更時も自動再計算

### 包絡線生成ルール
- 初期上昇: 最初の立ち上がりからPmaxまで、各繰返しのピークと必要な点を結んで上包絡を構築
- Pmax以降: 計測点を結ぶ（破壊による急激な低下点はスキップ）
- δ単調増加を保証し、面積積分・補間の安定性を確保
- 間引き: 包絡線点が 50 点を超える場合は弧長ベースの均等サンプリング法で重要点(先頭・末尾・最大荷重点、各ループの最大荷重点、δy・δu 近傍)を保持しつつ 40～50 点程度に自動間引き(包絡線全体に概ね均等に点を配置し、結果の再現性と視認性を両立)

### 補間精度
- δu（終局変位）: 0.8·Pmax交差点を線形補間で決定（包絡線点間でも正確）
- δy（降伏変位）: 包絡線とLineIV（Py水平線）交点を線形補間
- 面積S（等価エネルギー）: 0起点の区分台形積分＋終端補間で正確に計算

### 対話的編集
- 包絡線点の選択・移動・削除・追加・数値編集
- Undo/Redo機能（最大100履歴）
- 実験データへの自動吸着（スナップ）

### エクスポート
- Excel: 結果サマリ、データ、包絡線、グラフ画像を1ファイルに統合
- PDF: 評価レポート自動生成（入力値・結果・グラフ）

## 注意事項

- 直接入力方式のため、CSV取込やDG1〜4等の変位計データからの自動算出機能はこの版には含まれていません。
- 包絡線の自動生成は基準ルールに準拠していますが、試験体の特性に応じて手動編集が必要な場合があります。

## 参照
- 接合部及びその倍率の試験・評価業務方法書

## リネームについて
旧ファイル名に含まれていた `jtccm` 文字列は削除済みです。旧ファイルは使用しないでください。
